---
const {
  title = 'CasaHome Inmobiliaria',
  description = 'Lotes y viviendas con transparencia y acompañamiento total.',
  image = '/og-image.jpg',
} = Astro.props;
---

<html lang="es" class="scroll-smooth">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{title}</title>
    <meta name="description" content={description} />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:image" content={image} />
    <meta property="og:type" content="website" />
    <link rel="icon" href="/favicon.ico" />

    <!-- Google tag (gtag.js) -->
<link rel="preconnect" href="https://www.googletagmanager.com">
<link rel="preconnect" href="https://www.google-analytics.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-2067GDZLBQ"></script>
<script is:inline>
  window.dataLayer = window.dataLayer || [];
  function gtag(){ dataLayer.push(arguments); }
  gtag('js', new Date());
  gtag('config', 'G-2067GDZLBQ', { debug_mode: true });
  // Evento de prueba, por si el auto page_view no entra:
  gtag('event', 'page_view', { send_to: 'G-2067GDZLBQ' });
</script>


  </head>

  <body class="bg-white text-gray-800 dark:bg-gray-950 dark:text-gray-100 antialiased">
    <slot />

    <!-- 🔹 Vercel Analytics -->
    <script defer src="/_vercel/insights/script.js"></script>

    <!-- 🔹 Vercel Speed Insights -->
    <script defer src="/_vercel/speed-insights/script.js"></script>
  </body>
</html>

<style is:global>
  @import '../styles/global.css';

  /* 💫 Animación reveal */
  .reveal {
    opacity: 0;
    transform: translateY(40px);
    transition: opacity 0.8s ease, transform 0.8s ease;
  }
  .reveal.is-visible {
    opacity: 1;
    transform: translateY(0);
  }

  /* ✨ Animación de foco al navegar */
  .focus-anim {
    animation: focusBlink 0.8s ease;
  }
  @keyframes focusBlink {
    0%, 100% { outline: none; box-shadow: none; }
    50% { outline: 2px solid #facc15; box-shadow: 0 0 12px #facc15; }
  }
</style>

<!-- ⚙️ Script global: scroll reveal + navegación suave -->
<script is:inline>
  document.addEventListener('DOMContentLoaded', () => {
    // === Scroll Reveal ===
    const reveals = document.querySelectorAll('.reveal');
    const io = new IntersectionObserver((entries) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          entry.target.classList.add('is-visible');
          io.unobserve(entry.target);
        }
      });
    }, { threshold: 0.15 });
    reveals.forEach(el => io.observe(el));

    // === Smooth Scroll + Highlight ===
    const headerOffset = 72;
    const smoothScroll = (hash) => {
      const el = document.querySelector(hash);
      if (!el) return;
      const y = el.getBoundingClientRect().top + window.scrollY - headerOffset;
      window.scrollTo({ top: y, behavior: 'smooth' });
      el.classList.add('focus-anim');
      setTimeout(() => el.classList.remove('focus-anim'), 800);
    };

    document.addEventListener('click', (e) => {
      const link = e.target.closest('a[href^="#"]');
      if (!link) return;
      const href = link.getAttribute('href');
      if (!href || href === '#') return;
      e.preventDefault();
      history.replaceState(null, '', href);
      smoothScroll(href);
    });

    if (location.hash) setTimeout(() => smoothScroll(location.hash), 0);

    // === Nav activo ===
    const sections = ['#inicio', '#nosotros', '#proyectos', '#testimonios', '#contacto']
      .map(sel => document.querySelector(sel))
      .filter(Boolean);
    const navLinks = document.querySelectorAll('.nav-link');
    const ioNav = new IntersectionObserver((entries) => {
      entries.forEach((entry) => {
        const id = entry.target.id;
        if (!id) return;
        const link = Array.from(navLinks).find(a => a.getAttribute('href') === `#${id}`);
        if (link) link.dataset.active = entry.isIntersecting ? 'true' : 'false';
      });
    }, { rootMargin: '-50% 0px -40% 0px' });
    sections.forEach(sec => ioNav.observe(sec));
  });
</script>

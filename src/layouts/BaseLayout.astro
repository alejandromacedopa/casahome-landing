---
const {
  title = 'CasaHome Inmobiliaria',
  description = 'Lotes y viviendas con transparencia y acompañamiento total.',
  image = '/og-image.jpg',
} = Astro.props;
---

<html lang="es" class="scroll-smooth">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{title}</title>
    <meta name="description" content={description} />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:image" content={image} />
    <meta property="og:type" content="website" />
    <link rel="icon" href="/favicon.ico" />

    <!-- ✅ GA4 (ID real) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-WCR4J5GPC4"></script>
    <script is:inline>
      window.dataLayer = window.dataLayer || [];
      function gtag(){ dataLayer.push(arguments); }
      gtag('js', new Date());
      gtag('config', 'G-WCR4J5GPC4', { send_page_view: true });
    </script>

    <!-- (Opcional) Vercel -->
    <script defer src="/_vercel/insights/script.js"></script>
    <script defer src="/_vercel/speed-insights/script.js"></script>
  </head>

  <body class="bg-white text-gray-800 dark:bg-gray-950 dark:text-gray-100 antialiased">
    <slot />

    <!-- ✅ Tracking global basado en data-* -->
    <script is:inline>
      // Clics en elementos con data-event
      document.addEventListener('click', (e) => {
        const el = e.target.closest('[data-event]');
        if (!el || typeof gtag !== 'function') return;

        const base = el.dataset.event;                             // "whatsapp" | "contacto" | "ver_proyecto" | "proyecto" | ...
        const label = el.dataset.label || el.textContent?.trim() || 'sin_label';
        const project = el.dataset.project || null;

        gtag('event', base + '_click', {
          event_category: 'interacción',
          event_label: label,
          project_name: project,
        });

        // Debug en consola
        // console.log('GA4 →', base + '_click', { label, project });
      });

      // Envío de formulario (data-event="form-contacto")
      document.addEventListener('submit', (e) => {
        const form = e.target.closest('[data-event="form-contacto"]');
        if (!form || typeof gtag !== 'function') return;

        gtag('event', 'form_submit_contacto', {
          event_category: 'formulario',
          event_label: 'contacto',
        });
        // console.log('GA4 → form_submit_contacto');
      });
    </script>
  </body>
</html>

<style is:global>
  @import "../styles/global.css";

  /* Reveal simple (ya lo usabas) */
  .reveal { opacity: 0; transform: translateY(40px); transition: opacity .8s ease, transform .8s ease; }
  .reveal.is-visible { opacity: 1; transform: translateY(0); }
</style>

<!-- Reveal activador -->
<script is:inline>
  document.addEventListener('DOMContentLoaded', () => {
    const reveals = document.querySelectorAll('.reveal');
    const io = new IntersectionObserver((entries) => {
      entries.forEach((en) => en.isIntersecting && (en.target.classList.add('is-visible'), io.unobserve(en.target)));
    }, { threshold: 0.15 });
    reveals.forEach(el => io.observe(el));
  });
</script>
